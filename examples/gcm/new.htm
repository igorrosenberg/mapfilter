<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps JavaScript API v3 Example: Asynchronous Map Simple</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script type="text/javascript" src="js/util.js"></script>
    <style >
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

#button {
    width: 350px;
    float: right;
}

#map_canvas {
  height: 100%;
	width:100%;
  border: 1px solid blue;
  margin: 40px 40px;
  padding: 15px 15px;
  background-color: yellow;
}

#wrap_map_canvas {
  height: 260px;
	width: 360px;
}

@media print {
  html, body {
    height: auto;
  }

  #map_canvas {
    height: 650px;
  }
}
</style>
    <script>

	function loadCalendars() {
        var newData = [
        {title:'ONE', lat:48.00, lng:-1.50, info: 'xxx1'},
        {title:'TWO', lat:48.15, lng:-1.66, info: 'xxx2'},
        {title:'THREE', lat:48.30, lng:-1.80, info: 'xxx3'}
        ];
		console.log ('events before load: ' + event_markers.values().length );
		for (var i = 0 ; i < newData.length ; i++) {
			var x = newData[i];
			console.log ('event loaded: ' + x );
	        event_markers.add (x);
			}
		console.log ('events after load: ' + event_markers.values().length );
		}

	function createMarker(marker){
		// new Gmarker object
		var gMarker = new google.maps.Marker({
			position: new google.maps.LatLng(marker.lat, marker.lng),
			title: marker.desc,
			map: map,
			zIndex: 2,
			//  icon: image,
			});
 
			// add Listener that pops an infoWindow 
			google.maps.event.addListener(gMarker, 'click', function() {
				var infowindow = new google.maps.InfoWindow({content: marker.info});
				infowindow.open(map, gMarker);
			});
			return gMarker;
	}  // end createMarker
	  
	function addMarkersToMap() {
		var values = event_markers.values();
		for (var i = 0; i < values.length; i++) {
			// remember marker so hiding is posible
			values[i].gMarker = createMarker(values[i]);
			} // end for markers
	} // end addMarkersToMap

	function hideMarkersFromMap() {
		var values = event_markers.values();
		for (var i = 0; i < values.length; i++) {
			var marker = values[i];
			console.log ('hiding marker ' + marker.title + ' at ' + marker.lat) ;
			marker.gMarker.setMap(null) ;
		} // end for markers
	} // end addMarkersToMap

	function createMap() {

		// only create map if it doesn't exist
		if (!map) {
			var mapOptions = {
				zoom: 8,
				center: new google.maps.LatLng(48.114767,-1.68251), // Rennes
				mapTypeId: google.maps.MapTypeId.ROADMAP
           };
           map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
        }

      } // end createMap

	function initialize() {
		// document.getElementById('map_canvas').style.display = 'block' ;
		// document.getElementById('button').style.display = 'none' ;
		loadCalendars();
		createMap();
		addMarkersToMap();
	} // end initialize

	// the google map object
	var map;

	// list calendars currently active. 
	var calendarList = [];

	// list of the events with information. 
	var event_markers = new Set();

	/*
	 * Add google maps script if not there yet = async load gmaps
	 */ 
	function loadScript() {
 
		// calendarList = calendarList1;

		var g_id = 'google_maps';
		if ( ! document.getElementById(g_id) ) {
			var script = document.createElement('script');
			script.id = g_id;
			script.type = 'text/javascript';
			script.src = 'https://maps.googleapis.com/maps/api/js?v=3.10&sensor=false&callback=initialize';
			document.body.appendChild(script);
		} else {
			initialize();
		}            

	} // end loadScript

    </script>
  </head>
  <body>
    <div id="button">
		<a href='#' onclick="loadScript()">load map</a><br/>
		<a href='#' onclick="hideMarkersFromMap()">hideMarkersFromMap</a><br/><br/>
		<br/>
		<a href='http://jsfiddle.net/B3a86/2/'>Example many points</a><br/>
		<a href='https://developers.google.com/maps/documentation/javascript/reference#Map'>Google Maps API reference</a><br/>
	</div>
	<div id="wrap_map_canvas">
		<div id="map_canvas"></div>
	</div>
  </body>
</html>
